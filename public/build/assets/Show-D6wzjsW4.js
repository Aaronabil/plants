import{r,u as ee,f as M,j as e,H as se,t as d,d as te}from"./app-CmZ85Pt3.js";import{R as I,a as b,B as ae,b as re,W as ie}from"./radio-group-BsQkbX_m.js";import{I as y}from"./input-DnCgL49P.js";import{B as ne}from"./button-CgxK_lhP.js";import{T as le}from"./textarea-CEDltAhS.js";import{T as ce}from"./truck-CDTAo36Q.js";import{A as z,m as B}from"./proxy-C_QtfhOQ.js";import"./createLucideIcon-C-uGW5vV.js";import"./utils-DgWKjmuI.js";import"./index-dSc6CJZX.js";import"./index-CyN6Lvxv.js";import"./index-DIMu5qJI.js";import"./index-DuU4ieVV.js";import"./index-D3PW3_5I.js";import"./index-CzRyP23B.js";import"./index-BnpbIWum.js";function de({user:u,cartItems:o}){const[n,O]=r.useState("delivery"),[q,A]=r.useState("cod"),[l,D]=r.useState(null),T={initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3}},[m,v]=r.useState(""),[oe,me]=r.useState([]),[N,h]=r.useState([]),[pe,ue]=r.useState(null),[a,w]=r.useState(null),g=o.reduce((s,t)=>s+t.product.price*t.quantity,0),S=l?.cost||0,j=0,R=g+S-j,{data:i,setData:p,post:W,processing:xe,errors:he}=ee({fullName:u.name||"",email:u.email||"",phone:u.phone||"",address_detail:"",zip:"",agree:!1,shipping_type:n.toUpperCase(),shipping_fee:S,shipping_address:"",total_amount:R,cart_items:o.map(s=>s.id)}),U=s=>{if(s.preventDefault(),!i.fullName||!i.email||!i.phone){d.error("Please fill in your full name, email, and phone number.");return}if(n==="delivery"){if(!a){d.error("Please select a destination address.");return}if(!i.address_detail){d.error("Please provide the complete address details.");return}if(!l){d.error("Please select a shipping option.");return}}if(!i.agree){d.error("You must agree to the Terms and Conditions.");return}W("/orders",{onSuccess:()=>d.success("Order placed successfully!"),onError:()=>d.error("Failed to place order. Please try again.")})};r.useEffect(()=>{const s=g+(l?.cost||0)-j;p(t=>({...t,shipping_type:n.toUpperCase(),shipping_fee:l?.cost||0,total_amount:s,shipping_address:n==="delivery"&&a?`${i.address_detail}, ${a.subdistrict_name}, ${a.district_name}, ${a.city_name}, ${a.province_name} ${a.zip_code}`:"Pickup at store"}))},[n,l,g,j,a,i.address_detail]);const x=o.reduce((s,t)=>s+t.product.weight_in_kilograms*1e3*t.quantity,0),[_,V]=r.useState("jne:sicepat:jnt"),c={id:6175,label:"Tangerang",province_name:"Banten",city_name:"Tangerang",district_name:"Curug",subdistrict_name:"Curug Kulon",zip_code:"15810"},[G,k]=r.useState(!1),[ge,P]=r.useState(!1),[H,E]=r.useState(!1),[L,$]=r.useState([]),[F,f]=r.useState("");r.useEffect(()=>{if(m.length<2||a&&m===a.label){h([]);return}const s=setTimeout(()=>{K(m)},500);return()=>clearTimeout(s)},[m,a]);const K=async s=>{try{P(!0);const t=await M.get("/rajaongkir/search/destinations",{params:{search:s,limit:50}});t.data.meta.status==="success"&&(h(t.data.data||[]),k(!0))}catch(t){console.error("Search destination failed:",t),h([])}finally{P(!1)}},Y=r.useCallback(async()=>{if(!a){f("Please select destination");return}try{E(!0),f("");const s=await M.post("/rajaongkir/search/calculate-cost",{origin:c.id,destination:a.id,weight:Math.ceil(x),courier:_,price:"lowest"});s.data.meta.status==="success"?$(s.data.data):f(s.data.meta.message)}catch(s){f(s.response?.data?.meta?.message||"Failed to calculate shipping cost")}finally{E(!1)}},[a,x,_]);r.useEffect(()=>{a&&Y()},[a,x]);const J=s=>{w(s),v(s.label),k(!1),h([])},Q=s=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(s),X=(s,t)=>t?s.split(new RegExp(`(${t})`,"gi")).map((C,Z)=>C.toLowerCase()===t.toLowerCase()?e.jsx("span",{className:"bg-yellow-200 font-semibold",children:C},Z):C):s;return e.jsxs(e.Fragment,{children:[e.jsx(se,{title:"Checkout"}),e.jsx("div",{className:"min-h-screen bg-gray-50 flex justify-center items-start py-10",children:e.jsxs("form",{onSubmit:U,className:"w-full max-w-6xl bg-white shadow-lg rounded-2xl flex flex-col md:flex-row overflow-hidden",children:[e.jsxs("div",{className:"w-full md:w-1/2 p-8 border-r",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-3",children:"Checkout"}),e.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-md mb-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-900",children:"Store Location:"}),e.jsx("p",{className:"text-sm text-green-700",children:c.label}),e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:[c.subdistrict_name,", ",c.district_name,", ",c.city_name,", ",c.province_name," ",` - ${c.zip_code}`]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"Shipping Type"}),e.jsxs(I,{defaultValue:n,onValueChange:s=>O(s),className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-3 border rounded-lg px-4 py-3 cursor-pointer hover:bg-gray-50 transition w-64 justify-start",children:[e.jsx(b,{value:"delivery",id:"delivery"}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5"}),e.jsx("span",{children:"Delivery"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 border rounded-lg px-4 py-3 cursor-pointer hover:bg-gray-50 transition w-64 justify-start",children:[e.jsx(b,{value:"pickup",id:"pickup"}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),e.jsx("span",{children:"Pick Up"})]})]})]})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Full name"}),e.jsx(y,{value:i.fullName,onChange:s=>p("fullName",s.target.value),placeholder:"Type your name",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Email address"}),e.jsx(y,{type:"email",value:i.email,onChange:s=>p("email",s.target.value),placeholder:"Type your email",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Phone number"}),e.jsx(y,{type:"tel",value:i.phone,onChange:s=>p("phone",s.target.value),placeholder:"Type your phone number",required:!0})]}),e.jsx(z,{children:n==="delivery"&&e.jsxs(B.div,{...T,className:"space-y-4 overflow-hidden",children:[e.jsxs("div",{className:"border-b pb-6",children:[e.jsx("label",{className:"block font-medium",children:"Destination Address"}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search Destination"}),e.jsx(y,{type:"text",value:m,onChange:s=>{v(s.target.value),w(null)},onFocus:()=>N.length>0&&k(!0),placeholder:"Type city, district, or postal code..."}),G&&N.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto",children:N.map(s=>e.jsxs("div",{onClick:()=>J(s),className:"px-4 py-2 hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0",children:[e.jsx("div",{className:"font-medium text-gray-900",children:X(s.label,m)}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[s.subdistrict_name&&`${s.subdistrict_name}, `,s.district_name,", ",s.city_name,", ",s.province_name,s.zip_code&&` - ${s.zip_code}`]})]},s.id))}),a&&e.jsx("div",{className:"mt-2 p-3 bg-green-50 border border-green-200 rounded-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-900",children:"Selected:"}),e.jsx("p",{className:"text-sm text-green-700",children:a.label})]}),e.jsx("button",{type:"button",onClick:()=>{w(null),v(""),$([]),D(null)},className:"text-green-600 hover:text-green-800",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Complete Address"}),e.jsx(le,{value:i.address_detail,onChange:s=>p("address_detail",s.target.value)})]})]})}),e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Package Weight"}),e.jsxs("div",{className:"mt-1 p-3 bg-gray-50 border rounded-md",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:["Total Weight: ",(x/1e3).toFixed(2)," kg (",Math.ceil(x)," g)"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Calculated from your cart items"})]})]}),e.jsx("div",{children:e.jsx("input",{type:"hidden",value:_,onChange:s=>V(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"jne:sicepat:jnt",required:!0})})]}),F&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:F}),H&&e.jsx("div",{className:"w-full text-center py-3 text-gray-500",children:"Calculating shipping costs..."}),e.jsx(z,{children:n==="delivery"&&e.jsx(B.div,{...T,className:"space-y-4 overflow-hidden",children:L.length>0&&e.jsxs("div",{className:"mt-3 bg-white rounded-lg shadow-sm",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Shipping Options"}),e.jsx("div",{className:"space-y-3",children:L.map((s,t)=>e.jsx("div",{onClick:()=>D(s),className:`border rounded-lg p-4 transition cursor-pointer ${l?.service===s.service&&l.name===s.name?"border-green-600 bg-green-50":"border-gray-200 hover:border-green-600"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:s.name}),e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 text-xs rounded",children:s.service})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.description}),s.etd&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Estimated: ",s.etd]})]}),e.jsx("div",{className:"text-right ml-4",children:e.jsx("p",{className:"text-xl font-bold text-gray-900",children:Q(s.cost)})})]})},t))})]})})}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2 text-sm mt-2",children:[e.jsx("input",{type:"checkbox",checked:i.agree,onChange:s=>p("agree",s.target.checked)}),"I have read and agree to the Terms and Conditions."]})})]})]}),e.jsxs("div",{className:"w-full md:w-1/2 p-8 bg-gray-50",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Review your cart"}),e.jsxs("div",{className:"space-y-4",children:[o.map(s=>e.jsxs("div",{className:"flex justify-between items-center border-b pb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:s.product.images.find(t=>t.is_primary)?.image_url,alt:s.product.product_name,className:"w-12 h-12 object-cover rounded-md"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.product.product_name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.quantity,"x"]})]})]}),e.jsxs("p",{children:["Rp",(s.product.price*s.quantity).toLocaleString("id-ID")]})]},s.id)),e.jsxs("div",{className:"flex justify-between text-sm text-gray-500 pt-3",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["Rp",g.toLocaleString("id-ID")]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-500",children:[e.jsx("span",{children:"Shipping"}),e.jsxs("span",{children:["Rp",S.toLocaleString("id-ID")]})]}),j>0,e.jsxs("div",{className:"flex justify-between font-semibold text-lg border-t pt-3",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["Rp",R.toLocaleString("id-ID")]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"Payment Method"}),e.jsxs(I,{value:q,onValueChange:A,className:"flex flex-col gap-3",children:[e.jsxs("label",{className:"flex items-center gap-3 border rounded-lg px-4 py-3 cursor-pointer hover:bg-gray-50 transition w-full justify-start",children:[e.jsx(b,{value:"cod",id:"cod"}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{children:"Cash On Delivery"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 border rounded-lg px-4 py-3 cursor-pointer hover:bg-gray-50 transition w-full justify-start",children:[e.jsx(b,{value:"bank",id:"bank"}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),e.jsx("span",{children:"Midtrans"})]})]})]})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center mt-2",children:"ðŸ”’ Secure Checkout â€” SSL Encrypted"}),e.jsx(ne,{type:"submit",className:"w-full mt-4 bg-green-600 hover:bg-green-700 text-white",children:"Pay Now"})]})]})]})})]})}function $e(){const{auth:u,cartItems:o}=te().props,n=u.user;return e.jsx(e.Fragment,{children:e.jsx(de,{user:n,cartItems:o})})}export{$e as default};
