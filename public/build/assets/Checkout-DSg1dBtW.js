import{r as a,u as ae,f as P,j as e,H as re,t as n,a as R}from"./app-D8el9p_D.js";import{R as W,a as j,B as ie,b as ne,W as le}from"./radio-group-Dv3RkQmw.js";import{I as b}from"./input-DRdcWRxl.js";import{B as ce}from"./button-C3a5SMX5.js";import{T as de}from"./textarea-ClJp30iS.js";import{T as oe}from"./truck-DnL9v4G7.js";import{A as q,m as U}from"./proxy-BNyUX47M.js";import"./createLucideIcon-Cv3wxvPc.js";import"./utils-DgWKjmuI.js";import"./index-dSc6CJZX.js";import"./index-DChZJ1_8.js";import"./index-bGsnAHdf.js";import"./index-CDm79A2h.js";import"./index-DTchHo3b.js";import"./index-Bz3LDWKP.js";import"./index-7ay2WHCv.js";function Ie({user:y,cartItems:u,midtrans_client_key:E,midtrans_snap_url:L}){const[l,V]=a.useState("delivery"),[v,G]=a.useState("cod"),[c,$]=a.useState(null),I={initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3}},[o,N]=a.useState(""),[me,pe]=a.useState([]),[w,h]=a.useState([]),[ue,he]=a.useState(null),[r,S]=a.useState(null),x=u.reduce((s,t)=>s+t.product.price*t.quantity,0),_=c?.cost||0,g=0,M=x+_-g,{data:i,setData:m,post:xe,processing:ge,errors:fe}=ae({fullName:y.name||"",email:y.email||"",phone:y.phone||"",address_detail:"",zip:"",agree:!1,shipping_type:l.toUpperCase(),shipping_fee:_,shipping_address:"",total_amount:M,cart_items:u.map(s=>s.id)});a.useEffect(()=>{const s="midtrans-script";let t=document.getElementById(s);return t||(t=document.createElement("script"),t.id=s,t.src=L,t.setAttribute("data-client-key",E),t.async=!0,document.body.appendChild(t)),()=>{}},[L,E]);const H=async s=>{if(s.preventDefault(),!i.fullName||!i.email||!i.phone){n.error("Please fill in your full name, email, and phone number.");return}if(l==="delivery"){if(!r){n.error("Please select a destination address.");return}if(!i.address_detail){n.error("Please provide the complete address details.");return}if(!c){n.error("Please select a shipping option.");return}}if(!i.agree){n.error("You must agree to the Terms and Conditions.");return}try{const t=await P.post("/orders",{...i,payment_method:v});t.data.status==="success"&&(v==="bank"&&t.data.snap_token?window.snap.pay(t.data.snap_token,{onSuccess:function(D){n.success("Payment successful!"),R.visit("/")},onPending:function(D){n.info("Waiting for payment..."),R.visit("/")},onError:function(D){n.error("Payment failed!")},onClose:function(){n.warning("You closed the popup without finishing the payment")}}):(n.success("Order placed successfully! Please pay on delivery."),R.visit("/")))}catch(t){n.error(t.response?.data?.message||"Failed to place order."),console.error("Order failed:",t)}};a.useEffect(()=>{const s=x+(c?.cost||0)-g;m(t=>({...t,shipping_type:l.toUpperCase(),shipping_fee:c?.cost||0,total_amount:s,shipping_address:l==="delivery"&&r?`${i.address_detail}, ${r.subdistrict_name}, ${r.district_name}, ${r.city_name}, ${r.province_name} ${r.zip_code}`:"Pickup at store"}))},[l,c,x,g,r,i.address_detail]);const p=u.reduce((s,t)=>s+t.product.weight_in_kilograms*1e3*t.quantity,0),[k,Y]=a.useState("jne:sicepat:jnt"),d={id:6175,label:"Tangerang",province_name:"Banten",city_name:"Tangerang",district_name:"Curug",subdistrict_name:"Curug Kulon",zip_code:"15810"},[K,C]=a.useState(!1),[je,F]=a.useState(!1),[J,B]=a.useState(!1),[O,z]=a.useState([]),[A,f]=a.useState("");a.useEffect(()=>{if(o.length<2||r&&o===r.label){h([]);return}const s=setTimeout(()=>{Q(o)},500);return()=>clearTimeout(s)},[o,r]);const Q=async s=>{try{F(!0);const t=await P.get("/rajaongkir/search/destinations",{params:{search:s,limit:50}});t.data.meta.status==="success"&&(h(t.data.data||[]),C(!0))}catch(t){console.error("Search destination failed:",t),h([])}finally{F(!1)}},X=a.useCallback(async()=>{if(!r){f("Please select destination");return}try{B(!0),f("");const s=await P.post("/rajaongkir/search/calculate-cost",{origin:d.id,destination:r.id,weight:Math.ceil(p),courier:k,price:"lowest"});s.data.meta.status==="success"?z(s.data.data):f(s.data.meta.message)}catch(s){f(s.response?.data?.meta?.message||"Failed to calculate shipping cost")}finally{B(!1)}},[r,p,k]);a.useEffect(()=>{r&&X()},[r,p]);const Z=s=>{S(s),N(s.label),C(!1),h([])},ee=s=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(s),se=(s,t)=>t?s.split(new RegExp(`(${t})`,"gi")).map((T,te)=>T.toLowerCase()===t.toLowerCase()?e.jsx("span",{className:"bg-yellow-200 font-semibold",children:T},te):T):s;return e.jsxs(e.Fragment,{children:[e.jsx(re,{title:"Checkout"}),e.jsx("div",{className:"min-h-screen bg-gray-50 flex justify-center items-start py-10",children:e.jsxs("form",{onSubmit:H,className:"w-full max-w-6xl bg-white shadow-lg rounded-2xl flex flex-col md:flex-row overflow-hidden",children:[e.jsxs("div",{className:"w-full md:w-1/2 p-8 border-r",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-3",children:"Checkout"}),e.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-md mb-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-900",children:"Store Location:"}),e.jsx("p",{className:"text-sm text-green-700",children:d.label}),e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:[d.subdistrict_name,", ",d.district_name,", ",d.city_name,", ",d.province_name," ",` - ${d.zip_code}`]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"Shipping Type"}),e.jsxs(W,{defaultValue:l,onValueChange:s=>V(s),className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-3 border rounded-lg px-4 py-3 cursor-pointer hover:bg-gray-50 transition w-64 justify-start",children:[e.jsx(j,{value:"delivery",id:"delivery"}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5"}),e.jsx("span",{children:"Delivery"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 border rounded-lg px-4 py-3 cursor-pointer hover:bg-gray-50 transition w-64 justify-start",children:[e.jsx(j,{value:"pickup",id:"pickup"}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5"}),e.jsx("span",{children:"Pick Up"})]})]})]})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Full name"}),e.jsx(b,{value:i.fullName,onChange:s=>m("fullName",s.target.value),placeholder:"Type your name",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Email address"}),e.jsx(b,{type:"email",value:i.email,onChange:s=>m("email",s.target.value),placeholder:"Type your email",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Phone number"}),e.jsx(b,{type:"tel",value:i.phone,onChange:s=>m("phone",s.target.value),placeholder:"Type your phone number",required:!0})]}),e.jsx(q,{children:l==="delivery"&&e.jsxs(U.div,{...I,className:"space-y-4 overflow-hidden",children:[e.jsxs("div",{className:"border-b pb-6",children:[e.jsx("label",{className:"block font-medium",children:"Destination Address"}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search Destination"}),e.jsx(b,{type:"text",value:o,onChange:s=>{N(s.target.value),S(null)},onFocus:()=>w.length>0&&C(!0),placeholder:"Type city, district, or postal code..."}),K&&w.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto",children:w.map(s=>e.jsxs("div",{onClick:()=>Z(s),className:"px-4 py-2 hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0",children:[e.jsx("div",{className:"font-medium text-gray-900",children:se(s.label,o)}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[s.subdistrict_name&&`${s.subdistrict_name}, `,s.district_name,", ",s.city_name,", ",s.province_name,s.zip_code&&` - ${s.zip_code}`]})]},s.id))}),r&&e.jsx("div",{className:"mt-2 p-3 bg-green-50 border border-green-200 rounded-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-900",children:"Selected:"}),e.jsx("p",{className:"text-sm text-green-700",children:r.label})]}),e.jsx("button",{type:"button",onClick:()=>{S(null),N(""),z([]),$(null)},className:"text-green-600 hover:text-green-800",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Complete Address"}),e.jsx(de,{value:i.address_detail,onChange:s=>m("address_detail",s.target.value)})]})]})}),e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium",children:"Package Weight"}),e.jsxs("div",{className:"mt-1 p-3 bg-gray-50 border rounded-md",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:["Total Weight: ",(p/1e3).toFixed(2)," kg (",Math.ceil(p)," g)"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Calculated from your cart items"})]})]}),e.jsx("div",{children:e.jsx("input",{type:"hidden",value:k,onChange:s=>Y(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"jne:sicepat:jnt",required:!0})})]}),A&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:A}),J&&e.jsx("div",{className:"w-full text-center py-3 text-gray-500",children:"Calculating shipping costs..."}),e.jsx(q,{children:l==="delivery"&&e.jsx(U.div,{...I,className:"space-y-4 overflow-hidden",children:O.length>0&&e.jsxs("div",{className:"mt-3 bg-white rounded-lg shadow-sm",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Shipping Options"}),e.jsx("div",{className:"space-y-3",children:O.map((s,t)=>e.jsx("div",{onClick:()=>$(s),className:`border rounded-lg p-4 transition cursor-pointer ${c?.service===s.service&&c.name===s.name?"border-green-600 bg-green-50":"border-gray-200 hover:border-green-600"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:s.name}),e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 text-xs rounded",children:s.service})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.description}),s.etd&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Estimated: ",s.etd]})]}),e.jsx("div",{className:"text-right ml-4",children:e.jsx("p",{className:"text-xl font-bold text-gray-900",children:ee(s.cost)})})]})},t))})]})})}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2 text-sm mt-2",children:[e.jsx("input",{type:"checkbox",checked:i.agree,onChange:s=>m("agree",s.target.checked)}),"I have read and agree to the Terms and Conditions."]})})]})]}),e.jsxs("div",{className:"w-full md:w-1/2 p-8 bg-gray-50",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Review your cart"}),e.jsxs("div",{className:"space-y-4",children:[u.map(s=>e.jsxs("div",{className:"flex justify-between items-center border-b pb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:s.product.images.find(t=>t.is_primary)?.image_url,alt:s.product.product_name,className:"w-12 h-12 object-cover rounded-md"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.product.product_name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.quantity,"x"]})]})]}),e.jsxs("p",{children:["Rp",(s.product.price*s.quantity).toLocaleString("id-ID")]})]},s.id)),e.jsxs("div",{className:"flex justify-between text-sm text-gray-500 pt-3",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["Rp",x.toLocaleString("id-ID")]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-500",children:[e.jsx("span",{children:"Shipping"}),e.jsxs("span",{children:["Rp",_.toLocaleString("id-ID")]})]}),g>0,e.jsxs("div",{className:"flex justify-between font-semibold text-lg border-t pt-3",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["Rp",M.toLocaleString("id-ID")]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"Payment Method"}),e.jsxs(W,{value:v,onValueChange:G,className:"flex flex-col gap-3",children:[e.jsxs("label",{className:"flex items-center gap-3 border rounded-lg px-4 py-3 cursor-pointer hover:bg-gray-50 transition w-full justify-start",children:[e.jsx(j,{value:"cod",id:"cod"}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{children:"Cash On Delivery"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 border rounded-lg px-4 py-3 cursor-pointer hover:bg-gray-50 transition w-full justify-start",children:[e.jsx(j,{value:"bank",id:"bank"}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),e.jsx("span",{children:"Midtrans"})]})]})]})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center mt-2",children:"ðŸ”’ Secure Checkout â€” SSL Encrypted"}),e.jsx(ce,{type:"submit",className:"w-full mt-4 bg-green-600 hover:bg-green-700 text-white",children:"Pay Now"})]})]})]})})]})}export{Ie as default};
